<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8' />
    <title></title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v1.10.0/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v1.10.0/mapbox-gl.css' rel='stylesheet' />
    <link rel="stylesheet" href="css/map.css" />

    <style>

    </style>

  </head>

  <body>

    <div id='map'></div>
    <div class='map-overlay'>
      <div class='countycontainer'>
        <h2>RDOF @ Counties</h2>
          <div id='pd'><h3>Hover over a county!</h3>
            <h5><p>Eligible Locations: </p>0<br>
            <p>Reserved Price: </p>0<br></h5>
            
          </div>
          <h2>Census Block Group Details</h2>
      </div>
      
      <div class="cbgcontainer">
      
      <h3><strong>Socioeconomic Factors</strong></h3>
      <h5 id='hacs'>
        <p>Population: </p> 0<br>
        <p>Area: </p> 0<br>
        <p>Median Household Income: </p> 0<br>
        <p>Number of Households: </p> 0<br>
        <p>% Without Internet Subscription: </p> 0<br>
        <p>% Without computer</p>0<br>
        <!-- <p>% Senior: </p>0<br> -->
      </h5>

      <h3><strong>RDOF Details</strong></h3>
      <h5 id='hrdof'>
        <p>Eligible Locations: </p>0<br>
        <p>Reserved Price: </p>0<br>
      </h5>

      <h3><strong>Competitors</strong> </h3>
      <h5 id = 'isp'>
        <p>Number of Known ISPs: </p>0<br>
        <p>Number of Fiber Providers: </p>0<br>
        <p>Largest Provider @ Current CBG: </p>0<br>
        <p>Holding Company Name: </p>0<br>
      </h5>
      <!-- <h6 id = 'acknowledge'>
        Data Sources: <br>
        American Community Survey 2018 (5 years)<br>
        Federal Communication Committee<br>
        Ready.Net 

      </h6> -->
      </div>




    </div>

    <div class='legend' id='legend'>

      <h3>Number of Eligible Locations</h3>
      <div class="location-legend" id="location-id"></div>
      <div class="labels-legend">
        <span class="as-caption" >0 </span>
        <span class="as-caption" >36,000+</span>
        


      </div>

<!-- add search bars -->
  <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.5.1/mapbox-gl-geocoder.min.js"></script>
    <link
    rel="stylesheet"
    href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.5.1/mapbox-gl-geocoder.css"
    type="text/css"
    />
  <!-- Promise polyfill script required to use Mapbox GL Geocoder in IE 11 -->
  <script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.auto.min.js"></script>


  <script>
    var hoveredcbgId = null;

    mapboxgl.accessToken = 'pk.eyJ1IjoieXVhbnpmIiwiYSI6ImNrOXc4a3VwbzA2eGkzZHJ6bzg4anNpaHMifQ.xSyKndi9kO3wlTEnVnrDzA';

    var map = new mapboxgl.Map({
      container: 'map', // container id
      style: 'mapbox://styles/yuanzf/ck9wzv7l10o4k1imog78f29ft' // replace this with your style URL
    });


// helperfunctions//
function formatNumber(num) {
  return num.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g, '$1,')
}
function formatNumber2(num) {
  return num.toFixed(2).toString()
}

function currencyFormat(num) {
  return '$' + num.toFixed(2).replace(/(\d)(?=(\d{3})+(?!\d))/g, '$1,')
}
// helperfunctions//

      map.on('mousemove', function(e) {
        var counties = map.queryRenderedFeatures(e.point, {
          layers: ['rdofcounty']
          
        });
        
        
        if (counties.length > 0) {
          // console.log(counties)
          document.getElementById('pd').innerHTML = '<h3><strong>' + counties[0].properties.county_nam + ' County</h3></strong>'+
            '<h5><p>Eligible Locations: <strong></p>' + formatNumber(counties[0].properties.location) + '</strong><p> Total Reserved Price: <strong></p>' + currencyFormat(counties[0].properties.price) + '</strong></h5>';
        } else {
          document.getElementById('pd').innerHTML = '<h3>Hover over a county!</h3><h5><p>Eligible Locations: </p>0<br><p>Reserved Price: </p>0<br></h5>';
        }
      });

      map.on('mousemove', function(e) {
        var cbgs = map.queryRenderedFeatures(e.point, {
          layers: ['rdof-group']
          
        });
        
      });

      map.on('click','rdof-group', function(e) {



        document.getElementById('hacs').innerHTML = '<p>Population: </p>' +formatNumber(e.features[0].properties.pop)+'<br>'
                                                        + '<p>Area: </p>'+ formatNumber2(e.features[0].properties.area)+' sqmiles<br>'
                                                        + '<p>Median Household Income: </p>'+ currencyFormat(e.features[0].properties.income_m_h)+'<br>'
                                                        + '<p>Number of Households: </p>'+ e.features[0].properties.households_num+'<br>'
  
                                                        +'<p>% Without Internet Subscription: </p>'+ formatNumber2(e.features[0].properties.wCompuNoInterPer)+'% <br>'
                                                        +'<p>% Without computer: </p>'+ formatNumber2(e.features[0].properties.nComputerPerc) +'% <br>';
                                                        // +'<p>% Senior:</p>'+ e.features[0].properties.seniorPerc + '% ';
        document.getElementById('hrdof').innerHTML = '<p>Eligible Locations: </p>' + formatNumber(e.features[0].properties.locations)+ '<br>'
                                                        + '<p>Reserved Price: </p>'+ currencyFormat(e.features[0].properties.reserve)

       document.getElementById('isp').innerHTML = '<p>Number of Known ISPs: </p>'+formatNumber(e.features[0].properties.num_ISPs)+
                                                  '<br><p>Number of Fiber Providers: </p>'+e.features[0].properties.is_fiber+
                                                  '<br><p>Largest Provider @ Current CBG: </p>'+e.features[0].properties.ProviderName_01 +
                                                  '<br><p>Holding Company Name: </p>'+e.features[0].properties.HoldingCompanyName_01+'<br>';

          new mapboxgl.Popup()
          .setLngLat(e.lngLat)
          .setHTML('<p>Census Block Group ID: '+ e.features[0].properties.FIPS+'</p>'+
          '</h2><p>Local Population: '+ formatNumber(e.features[0].properties.pop)+'</p><br>'
            +'<h3><strong>Eligible Locations: </strong></h3><h2>'+ formatNumber(e.features[0].properties.locations)+
            '<br></h2><h3><strong>Reserved Price: </strong></h3><h2>'+ currencyFormat(e.features[0].properties.reserve)
            )
          .addTo(map);
          });
          
          // Change the cursor to a pointer when the mouse is over the states layer.
          map.on('mouseenter', 'rdof-group', function() {
          map.getCanvas().style.cursor = 'pointer';
          });
          
          // Change it back to a pointer when it leaves.
          map.on('mouseleave', 'rdof-group', function() {
          map.getCanvas().style.cursor = '';
          });

          

      map.addControl(
      new MapboxGeocoder({
      accessToken: mapboxgl.accessToken,
      mapboxgl: mapboxgl
      })
);


  </script>



  </body>

</html>
